# 封闭式透明显示实验方案

> 本实验方案只测试封闭式显示系统实时环境信息还原的可行性，暂不考虑更多功能设计。

2023/1/8 [Pancake 光学验证 01](https://blog.seybox.com/2023/01/08/devlog-pancake-evaluation1/)

## 背景

​        透明显示技术，顾名思义，即利用透光性显示介质进行信息展示。透明显示具有不完全遮挡视野，功能设计灵活，外观简洁的优点，在新概念交互，增强现实与混合现实（以下统称 XR）领域有着广泛的应用前景。本实验所讨论的就是面向 XR 领域的一种透明显示技术。       

​        目前 XR 领域应用的透明显示技术主要包括：**棱镜方案、自由曲面方案、光波导方案**。

​        棱镜方案利用了光学棱镜的分光特性，为棱镜镀上特殊镀层，使来自微型投影仪的光线在反射面半透射半反射，同时不阻碍外界光线穿过反射面，实现在不遮挡视野的情况下显示信息。使用棱镜方案的代表性 XR 产品为谷歌眼镜。谷歌眼镜最初发布于 2012 年 4 月，提供了路径导航、消息提示、录像摄像等功能。

​        自由曲面方案是指借助计算机辅助光学模拟，设计出一种不规则的反射玻璃曲面。反射玻璃同时负责微型投影仪光线的变焦和反射。自由曲面方案去除了玻璃镀膜的步骤，提高了整体透光度，但方案设计较为复杂。采用自由曲面方案的代表性 XR 产品为爱普生 BT 系列智能眼镜。该系列眼镜主打投屏、观影功能。

​        光波导方案利用光的全反射特性，利用类似光纤的设计原理，在薄层玻璃中进行光线传输。光波导镜片一般是侧面进光，正面发光，具有 “平行光进，平行光出” 的特性。光波导方案是目前最薄，视场角最大的物理透明显示方案。采用光波导方案的代表性 XR 产品为微软 Hololens 系列混合现实头盔。该产品正在开发工业辅助、教学、游戏等方面的功能。

​        现存的透明显示方案都存在类似的问题：由于都基于对物理光路的改变，观察角度对显示效果有较大影响。用户稍微改变观察角度就会导致图像缺失、视场角变窄；由于都采用玻璃作为反光介质，显示对比度、亮度都受到限制，图像无法完全遮挡环境光线，始终呈半透明状；由于显示设备重量与体积的要求，显示视场角（以下统称Fov）被限制在60°以下。

​        为解决上述现存问题，本实验提出**一种基于封闭式光学结构与环境信息还原的透明显示方案**。

## 概述

​        封闭式显示，指完全不借助环境光线进行成像的显示系统。最常见的封闭式显示设备就是 VR 头显。目前主流的 VR 头显都采用将环境光完全遮挡，采用屏幕配合透镜的光学系统进行双目视觉成像的显示方案。此类显示方案的优点在于配合设计良好的外壳，设备可以达到极高的遮光率，保证用户视野中没有眩光、God light，只呈现显示内容。同时，此类方案可以达到极大的 Fov （如小派8k+，利用双屏显示达到了 200° 视场角）。

​        封闭式显示系统解决了物理透明显示方案可观察角度小，图像透明，Fov 小的缺陷，但缺少了透明显示中重要的环境信息。此方案提出：使用外部摄像头进行环境信息的采集，并在屏幕上实时播放，实现环境信息的还原。其他信息的显示可以通过在环境视频流基础上进行叠加实现。此方案解决了物理透明显示方案的绝大部分问题，方案的实现存在两个技术难点：头显设备必须足够轻便，降低长期使用时给颈椎带来的压力；环境信息还原时延必须足够小，防止引起用户眩晕。

​        针对第一个问题，方案将电源模块从头显分离，并对外壳支撑部分尽量进行镂空设计，使用轻薄的柔性遮光材质代替工程塑料，将头显部分重量降低到140g以下。同时，需要将电源线束固定在肩部，防止颈椎承受线束的重量。针对第二个问题，方案采用 FPGA 直接进行摄像头数据采集，经过反畸变运算直接输出到屏幕，避免了使用片上操作系统、多次格式转换所导致的软件时延。理想的环境信息还原时延应控制在 5ms 以内。

​        **本实验方案只测试封闭式显示系统实时环境信息还原的可行性，暂不考虑更多功能设计**。

## 硬件设计

​        设备硬件分为头显与电源两个部分。头显由两个摄像头、用于采集与处理的 FPGA、两块屏幕、光学透镜和外壳组成。头显设计最高重量为120g，显示分辨率为单目1080p以上。头显通过线缆与电源部分连接。

### 摄像头

​        市面上主流的摄像头供应商有 OmniVision 与索尼等。OmniVision 提供从 30w 到 1600w 像素不等的 cmos 摄像头模组，索尼提供1080p以上的高帧率摄像头模组。但由于索尼模组的配置、驱动方式没有在数据手册中列出，故在 ov 系列摄像头中进行选型。

| 型号           | 传感器像素 | 实时帧率                  |
| -------------- | ---------- | ------------------------- |
| OV7670, OV7725 | 30w        | 320x240 24fps             |
| OV2640         | 200w       | 1600x1200 15fps, 2x 30fps |
| OV5640         | 500w       | 2592x1944 15fps, 2x 45fps |
| OV13850        | 1300w      | 4224x3136 30fps, 2x 60fps |

​        为尽量保证摄像头到屏幕的传输过程没有分辨率和帧率损失，**摄像头拟选用 OV13850型号**。

### FPGA

​        目前常用的 FPGA 芯片厂商主要有 Intel 与 Xilinx 两家。Intel（原 Altera） 系列芯片在高校应用较广，主要系列包括 Arria，MAX，Cyclone 等，以及高端应用领域的 Agilex，Stratix 系列。Xilinx 相对于 Intel FPGA 历史更悠久，其产品更多被企业采用，提供更多的 IP 核，覆盖更广应用领域。 由于在本方案中，视频流输入输出的需求占用大量差分信号接口，故选型时以接口数量而非逻辑资源作为主要考虑因素。同时，对于视频流处理过程中需求的 RAM 等因素也应作考虑。

​        已知的 IO 需求包括：两份 mipi-dsi 4lane 屏幕数据传输，两份 mipi-dsi 4lane 摄像头数据传输。

​        [Xilinx 芯片选型手册](https://www.xilinx.com/support/documentation/selection-guides/cost-optimized-product-selection-guide.pdf)

​        [Intel 芯片选型工具](https://www.intel.com/content/www/us/en/programmable/products/general/selector/product-selector/by-parameters.html)

| 型号                    | 逻辑单元 | 最大差分线对 |
| ----------------------- | -------- | ------------ |
| Xilinx Spartan-7 XC7S15 | 12800    | 48           |

​        FPGA选型待定，暂时**拟选用 XC7S15型号**。

### 屏幕

​        显示模组的种类和厂商较多，按照发光原理大致分为 IPS，TFT-LCD，AMOLED，硅基OLED（微型），低温PMOLED等。现有的 VR 显示面板一般采用 LCD 或 AMOLED 面板，面板的评判标准主要有余晖、噪点、对比度等。AMOLED在低余晖与高对比度上具有天生优势，但价格较同等尺寸普通LCD面板高三到五倍，高端LCD面板可以很好控制余晖效应，一个应用的例子是 Valve Index VR 头显。

​        此处给出几种屏幕选型方案：

| 面板类型 | 尺寸      | 分辨率    | 参考价 | 重量     |
| -------- | --------- | --------- | ------ | -------- |
| TFT-LCD  | 5.4 英寸  | 1152x1920 | 55￥   | 约18.5克 |
| TFT-LCD  | 5.5 英寸  | 1440x2560 | 60￥   | 约25克   |
| AMOLED   | 3.81 英寸 | 1200x1080 | 426￥  | 约10克   |
| 硅基OLED | 0.71 英寸 | 1080x1920 | 1000￥ | 略       |

​        屏幕选型待定，暂时**拟选用 5.5 英寸 2k TFT-LCD 面板**。

### 光学

​        封闭式显示系统有多种成熟的光学设计，例如基于单屏幕菲涅尔透镜的方案（Oculus DK1）、双屏幕菲涅尔透镜的方案（小派8k+）、单屏幕超短焦光学方案（华为 VR Glass）等。其中，单屏幕方案最为简单，但存在视场角普遍较小的问题。超短焦方案的光学系统复杂，需要较高的设计和加工水平。

​        此方案**拟采用双屏菲涅尔透镜方案**。

​        透镜例：直径60mm焦距28mm菲涅尔透镜、k9光学直径42mm焦距65mm球面镜。

### 外壳

​        （待设计）

​        此方案**拟采用3D打印镂空框架配合柔性遮光材料方案**。

### 电源

​        （待设计）

​        此方案**拟采用外接式电源设计**。

## 软件设计（待补充）

### 视频采集

​        （FPGA 通过 mipi 接口采集数据）

### 反畸变

​        （FPGA 将数据进行反畸变变换）

### 视频输出

​        （FPGA 通过 mipi 接口输出数据）
